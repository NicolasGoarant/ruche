<% content_for :nav_active, 'contributions' %>
<% content_for :title, t('contributions_section.title', default: 'Partages') %>

<% content_for :styles do %>
  <style>
    .contributions-index {
      padding: 4rem 0;
    }

    .back-link {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      color: var(--color-text-muted);
      text-decoration: none;
      font-size: 0.9rem;
      margin-bottom: 2rem;
      transition: color 0.2s;
    }

    .back-link:hover { color: var(--color-primary); }

    .filter-bar {
      display: flex;
      gap: 0.7rem;
      flex-wrap: wrap;
      justify-content: center;
      margin-bottom: 2.5rem;
    }

    .filter-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      padding: 0.5rem 1.2rem;
      border-radius: 20px;
      border: 2px solid var(--color-border);
      background: white;
      color: var(--color-text);
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .filter-btn:hover {
      border-color: var(--color-primary);
      color: var(--color-primary);
    }

    .filter-btn.active {
      border-color: var(--color-primary);
      background: #FFF8E7;
      font-weight: 600;
      color: var(--color-dark);
    }

    .filter-mobile {
      display: none;
      margin-bottom: 2.5rem;
    }

    .filter-mobile select {
      width: 100%;
      padding: 0.8rem 1rem;
      border-radius: var(--radius-md);
      border: 2px solid var(--color-border);
      background: white;
      font-family: var(--font-body);
      font-size: 0.95rem;
      font-weight: 500;
      color: var(--color-text);
      appearance: none;
      -webkit-appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%23666' stroke-width='2' fill='none'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      padding-right: 2.5rem;
      cursor: pointer;
    }

    .filter-mobile select:focus {
      outline: none;
      border-color: var(--color-primary);
    }

    @media (max-width: 768px) {
      .filter-bar { display: none; }
      .filter-mobile { display: block; }
    }
  </style>
<% end %>

<section class="contributions-index">
  <div class="container">
    <a href="<%= root_path %>" class="back-link">‚Üê <%= t('contributions_section.back', default: 'Retour √† l\'accueil') %></a>

    <div class="section-header">
      <h2><%= t('contributions_section.title') %></h2>
      <p><%= t('contributions_section.subtitle') %></p>
    </div>

    <!-- Desktop: pills -->
    <div class="filter-bar">
      <a href="<%= contributions_path %>" class="filter-btn <%= 'active' unless params[:type].present? %>">
        üßµ <%= t('contributions_section.filter_all', default: 'Tous') %>
      </a>
      <% Contribution::TYPE_CONFIG.each do |type, config| %>
        <a href="<%= contributions_path(type: type) %>" class="filter-btn <%= 'active' if params[:type] == type %>">
          <%= config[:emoji] %> <%= config[:label] %>
        </a>
      <% end %>
    </div>

    <!-- Mobile: dropdown -->
    <div class="filter-mobile">
      <select onchange="window.location.href = this.value">
        <option value="<%= contributions_path %>" <%= 'selected' unless params[:type].present? %>>
          üßµ <%= t('contributions_section.filter_all', default: 'Tous les partages') %>
        </option>
        <% Contribution::TYPE_CONFIG.each do |type, config| %>
          <option value="<%= contributions_path(type: type) %>" <%= 'selected' if params[:type] == type %>>
            <%= config[:emoji] %> <%= config[:label] %>
          </option>
        <% end %>
      </select>
    </div>

    <div class="cards">
      <% @contributions.each do |c| %>
        <a href="<%= contribution_path(c) %>" style="text-decoration: none; color: inherit;">
          <div class="card" style="border-left-color: <%= c.type_color %>">
            <% if c.main_photo_url.present? %>
              <img src="<%= c.main_photo_url %>" alt="<%= c.translated_title %>" class="card-img" loading="lazy">
            <% end %>
            <div class="card-body">
              <h3><%= c.type_emoji %> <%= c.translated_title %></h3>
              <p><%= c.translated_description.truncate(120) %></p>
              <div class="card-meta">
                üìç <%= c.location %> ¬∑ <%= c.author_flag %> <%= c.author_name %> ¬∑ <%= c.formatted_date %>
              </div>
            </div>
          </div>
        </a>
      <% end %>
    </div>

    <% if @contributions.empty? %>
      <div style="text-align: center; padding: 3rem; color: var(--color-text-muted);">
        <p style="font-size: 1.1rem; margin-bottom: 1rem;"><%= t('contributions_section.empty', default: 'Aucun partage pour le moment.') %></p>
        <a href="<%= new_contribution_path %>" class="cta-primary"><%= t('contributions_section.cta_contribute', default: '+ Partager') %></a>
      </div>
    <% end %>
  </div>
</section>
